# http协议

## http协议的发展历史

http协议 称为'超文本传输协议'

### HTTP协议的初始版本HTTP/0.9

1990出现，还只是一个未成形的产品，存在的严重的缺陷只允许GET方法，不支持MIM类型.
```
  MIME, 全称为“Multipurpose Internet Mail Extensions”, 比较确切的中文名称为“多用途互联网邮件扩展”。它是当前广泛应用的一种电子邮件技术规范，基本内容定义于RFC 2045-2049
```

### HTTP/1.0

这是一个相对完善的HTTP协议版本，发布于1996年5月。至今有些服务器还在沿用。

主要特性有：

1. 新增POST和HEAD命令
2. HTTP请求和响应的格式都发生了改变，每次通信都需要带上头信息（HTTP header）,用来描述一些元数据。
3. **相对于之前的http协议，新版的http协议允许传输任何文件，图片、音频、视频都能够通过转码进行传输**
4. 新增状态码（status code）、多字符集支持、多部分发送（multi-part type）、权限（authorization）、缓存（cache）、内容编码（content encoding）等。
5. http1.0实现了Connection:Keep-Alive，允许在头部添加这个参数，来使得一条tcp链接持续打开

不足之处：

每个TCP链接一次**只能发送一个请求**，在传输完成之后请求就中断，重新建立一个请求需要三次握手，并且开始发送的速度很慢。这种问题在网页资源较多的情况下性能很差

### HTTP/1.1

主要特性：

  1. 修复了1.0版本的不足TCP不能复用的问题，引入了持久型链接，默认TCP链接不关闭，可以被多个请求复用，也不用
  声明**Connection: keep-alive**，打开的TCP链接可以通过在头部加上Connection：close手动关闭链接，或者在等待一段时间后服务器自动关闭。
  2. 引入了管道机制（pipelining），即在同一个TCP连接里面，客户端可以同时发送多个请求。这样就进一步改进了HTTP协议的效率。举例来说，客户端需要请求两个资源。以前的做法是，在同一个TCP连接里面，先发送A请求，然后等待服务器做出回应，收到后再发出B请求。**管道机制则是允许浏览器同时发出A请求和B请求，但是服务器还是按照顺序，先回应A请求，完成后再回应B请求。**
  3. 将Content-length字段的作用进行扩充，即声明本次回应的数据长度（一个TCP连接现在可以传送多个回应，势必就要有一种机制，区分数据包是属于哪一个回应的）
  4. 采用分块传输编码，对于一些很耗时的动态操作，服务器需要等到所有操作完成，才能发送数据，显然这样的效率不高。更好的处理方法是，产生一块数据，就发送一块，采用"流模式"（stream）取代"缓存模式"（buffer）
  5. 新增一些请求方法 PUT、DELETE PATCH、OPTIONS、HEAD
  6. 客户端头信息新增HOST字段用来指定服务器域名

  不足之处： 

  虽然有持久型链接，但是一个TCP链接的数据的接收传输还是同步的，所以先发出去的请求响应慢的话会影响后续请求的加载，这叫'队头阻塞'。解决的办法是减少请求和多开持久型链接

### HTTP/2

#### HTTP / 2支持HTTP / 1.1的所有核心功能，但旨在通过多种方式提高效率。

特性：

1. HTTP/2 的头信息是一个彻底的二进制协议，头信息和数据体都是二进制，并且统称为帧（frame）:头信息和数据帧
2. 持续性TCP链接可以同时收发请求，避免了队头阻塞
3. HTTP / 2通过定义HTTP语义到底层连接的优化映射来解决这些问题。具体而言，它允许在同一连接上交错请求和响应消息，并使用HTTP头字段的有效编码。它还允许对请求进行优先级排序，使更多重要请求更快地完成，从而进一步提高性能。
4. HTTP 协议不带有状态，每次请求都必须附上所有信息。所以，请求的很多字段都是重复的，比如Cookie和User Agent，一模一样的内容，每次请求都必须附带，这会浪费很多带宽，也影响速度。
5. HTTP/2 允许服务器未经请求，主动向客户端发送资源，这叫做服务器推送（server push）。
